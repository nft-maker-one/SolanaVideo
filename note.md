# Solana å­¦ä¹ ç¬”è®°
Web3 å¼€å‘è€…äº¤æµç¤¾ç¾¤ä»‹ç»â€‹
ğŸ“¢ å¦‚æœä½ ä¹Ÿåœ¨ç ”ç©¶åŒºå—é“¾æŠ€æœ¯ï¼Œç‰¹åˆ«æ˜¯å¯¹ Solana æ™ºèƒ½åˆçº¦å¼€å‘ã€åŒºå—é“¾åŸç†æ„Ÿå…´è¶£ï¼Œæ¬¢è¿åŠ å…¥è¿™ä¸ªäº¤æµç¤¾ç¾¤ï¼æˆ‘ç›®å‰åœ¨åˆ¶ä½œç›¸å…³çš„æŠ€æœ¯åˆ†äº«è§†é¢‘ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·è®¨è®ºè§†é¢‘å†…å®¹ï¼Œåˆ†äº«å­¦ä¹ å¿ƒå¾—ã€‚â€‹
ä¸ç®¡ä½ æ˜¯åˆšå…¥é—¨çš„å°ç™½ï¼Œè¿˜æ˜¯å·²ç»æœ‰ä¸€å®šç»éªŒçš„å¼€å‘è€…ï¼Œéƒ½èƒ½åœ¨è¿™é‡Œç•…æ‰€æ¬²è¨€ã€‚é‡åˆ°æŠ€æœ¯éš¾é¢˜ï¼Œç¾¤å‹ä»¬å¯ä»¥äº’ç›¸å¸®å¿™å‡ºè°‹åˆ’ç­–ï¼›æœ‰æ–°çš„è§è§£å’Œå‘ç°ï¼Œä¹Ÿèƒ½éšæ—¶å’Œå¤§å®¶äº¤æµã€‚æ²¡æœ‰åä¸½çš„æ´»åŠ¨åŒ…è£…ï¼Œå°±æ˜¯ä¸€ç¾¤çƒ­çˆ±åŒºå—é“¾æŠ€æœ¯çš„ä¼™ä¼´ï¼Œè¸è¸å®å®å­¦ä¹ ã€äº¤æµã€‚â€‹
ğŸ“± æ‰«æä¸‹æ–¹ç¤¾ç¾¤äºŒç»´ç ï¼Œå°±èƒ½ç›´æ¥å…¥ç¾¤ã€‚è¦æ˜¯äºŒç»´ç å¤±æ•ˆäº†ï¼Œæ·»åŠ æˆ‘çš„å¾®ä¿¡ï¼ˆè§ä¸‹æ–¹å¾®ä¿¡äºŒç»´ç å›¾ç‰‡ï¼‰ï¼Œå¤‡æ³¨ã€åŒºå—é“¾å­¦ä¹ ã€‘ï¼Œæˆ‘æ‹‰ä½ è¿›ç¾¤ï¼Œå’±ä»¬ä¸€èµ·åœ¨ Web3 çš„ä¸–ç•Œé‡Œæ¢ç´¢è¿›æ­¥ï¼
![alt text](909f703f3c2c6b26afe407d0a078c776.jpg)
![alt text](a207c5d477752feca85e5b7307bdb1e2.jpg)

## Solana å®ç° Hello world
Solana æœ¬åœ°å¼€å‘ç¯å¢ƒçš„æ­å»ºè¾ƒä¸ºå¤æ‚ï¼Œåœ¨åˆå­¦é˜¶æ®µï¼Œæ¨èå¤§å®¶ä½¿ç”¨ [Solana Playgroud](https://beta.solpg.io/) è¿›è¡Œå¼€å‘ã€‚ä¸Šé¢æœ‰æ­å»ºå¥½çš„ Solana å¼€å‘ç¯å¢ƒï¼Œå¹¶ä¸”æä¾›äº† Solana å·¥ç¨‹çš„å¼€å‘æ¨¡æ¿ï¼Œæ˜“äºåˆå­¦è€…ä¸Šæ‰‹.  
![alt text](image.png)  

æ‰“å¼€ç•Œé¢åç‚¹å‡»å³ä¸Šè§’çš„åŠ å·åˆ›å»ºå·¥ç¨‹ï¼Œå¹¶ä¸”åœ¨å·¥ç¨‹é€‰é¡¹ä¸­é€‰æ‹© Native(Rust)ï¼Œæ¥ä¸‹æ¥ä¾¿å¯ä»¥è¿›å…¥å·¥ç¨‹çš„å¼€å‘ã€‚  
### æ–‡ä»¶ç›®å½•ä»‹ç»
æ–‡ä»¶åˆ›å»ºåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›®å½•ä¸­æœ‰ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œåˆ†åˆ«æ˜¯ src,client,tests. å…¶ä¸­ src æ–‡ä»¶å¤¹ä¸‹å­˜å‚¨äº†åˆçº¦å·¥ç¨‹æ–‡ä»¶ lib.rs,ç”¨æ¥ç¼–å†™æˆ‘ä»¬çš„ Solana æ™ºèƒ½åˆçº¦é€»è¾‘ã€‚ client æ–‡ä»¶å¤¹ä¸‹é¢å­˜å‚¨äº† client.ts æ–‡ä»¶ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªä¸ Solana ç½‘ç»œäº¤æ¢çš„å‰ç«¯æ¨¡æ¿ç¨‹åºã€‚æœ€åçš„ test æ–‡ä»¶å¤¹ä¸‹é¢å­˜å‚¨äº†ä¸€ä¸ªå¯¹ @solana/web3.js ä¸­ API åŠŸèƒ½çš„æµ‹è¯•æ–‡ä»¶ã€‚

![alt text](image-1.png)


### åˆçº¦é€»è¾‘ç¼–è¾‘
æ‰“å¼€ src æ–‡ä»¶å¤¹ä¸‹çš„ lib.rs æ–‡ä»¶ï¼Œæˆ‘ä»¬æ¸…é™¤æ‰ Solana Playground ç»™æˆ‘ä»¬æä¾›çš„åˆå§‹æ¨¡æ¿ï¼Œå¹¶è´´å…¥æˆ‘ä»¬ä¸‹é¢çš„ hello world ç¨‹åºä»£ç ã€‚  
 
```rust
use solana_program::{
    account_info::AccountInfo,
    entrypoint,
    entrypoint::ProgramResult,
    pubkey::Pubkey,
    msg,
};

entrypoint!(process_instruction);

pub fn process_instruction(
    _program_id: &Pubkey,
    _accounts:&[AccountInfo],
    _instruction_data:&[u8],
) -> ProgramResult {
    msg!("Hello world!!");
    Ok(())
}

```

å®Œæˆä»£ç åï¼Œæˆ‘ä»¬ç‚¹å‡»ç•Œé¢å·¦ä¾§çš„ build & deploy å›¾æ ‡ï¼Œä¹‹åå¯¹æˆ‘ä»¬çš„å·¥ç¨‹è¿›è¡Œ buildï¼Œbuild åœ¨æ§åˆ¶å°æ˜¾ç¤ºæˆåŠŸåï¼Œç‚¹å‡»ä¸‹æ–¹çš„ deploy è¿›è¡Œåˆçº¦éƒ¨ç½²ï¼Œè¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªSolana æ™ºèƒ½åˆçº¦åœ¨ devnet ç½‘ç»œä¸Šçš„éƒ¨ç½²

![alt text](image-2.png)

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéƒ¨ç½²åˆçº¦éœ€è¦ Solana ä½œä¸º gas ï¼Œå¦‚æœè´¦æˆ·å†… Solana ä¸è¶³çš„è¯ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä¸‹é¢è¯­å¥ç”³è¯· Solana ç©ºæŠ•

```shell
solana airdrop 2
```


### å‰ç«¯æ–‡ä»¶æ”¹å†™
è¿›å…¥ client ä¸‹çš„ client.ts æ–‡ä»¶å¤¹ã€‚å¤åˆ¶ä¸‹é¢å†…å®¹

```typescript
transaction.add({
  keys:[],
  programId:new web3.PublicKey(pg.PROGRAM_ID),
})
const txHash = await web3.sendAndConfirmTransaction(
  pg.connection,
  transaction,
  [pg.wallet.keypair],
)

console.log(txHash);
```


## Solana å®ç°è®¿é—®è®¡æ•°å™¨

### åˆçº¦é€»è¾‘
```rust
use borsh::{BorshSerialize,BorshDeserialize};
use solana_program::{
    account_info::{AccountInfo,next_account_info},
    pubkey::Pubkey,
    entrypoint::ProgramResult,
    entrypoint,
    msg,
    program_error::ProgramError
};

#[derive(BorshSerialize,BorshDeserialize)]
pub struct Counter {
    num:i32
}

entrypoint!(process_instruction);

pub fn process_instruction(
    program_id:&Pubkey,
    accounts:&[AccountInfo],
    _instruction_data:&[u8]
) -> ProgramResult {
    let account_iter = &mut accounts.iter();
    let account = next_account_info(account_iter)?;
    if account.owner != program_id {
        return Err(ProgramError::IncorrectProgramId)
    }
    let mut counter = Counter::try_from_slice(&account.data.borrow())?;
    counter.num += 1;
    counter.serialize(&mut *account.data.borrow_mut())?;
    msg!("{} access for {} times",account.key.to_string(),counter.num);
    Ok(())
    
}


```




### å‰ç«¯äº¤äº’å’ŒSolanaçš„äº¤æ˜“æ¨¡å‹
#### åºåˆ—åŒ–è§„åˆ™è®¾ç½®
```typescript

class Counter {
  num:number
  constructor(fields:{num:number}|undefined=undefined) {
    if (fields) {
      this.num = fields.num;
    } 
  }
}

const Schema = new Map([
  [Counter,{kind:"struct",fields:[["num","u32"]]}]
])

const space = borsh.serialize(Schema,new Counter()).length
const lamports = await pg.connection.getMinimumBalanceForRentExemption(space);
const keypair = new web3.Keypair();


console.log("space = ",space)
console.log("lamports = ",lamports)

```


#### ä¸€æ¬¡è®¡æ•°çš„å®Œæˆ
```typescript

const createAccountTxIs = web3.SystemProgram.createAccount({
  fromPubkey:pg.wallet.publicKey,
  newAccountPubkey:keypair.publicKey,
  lamports,
  space:dataSize,
  programId:pg.PROGRAM_ID
});

const addTxIs = new web3.TransactionInstruction({
  keys:[
    {
      pubkey:keypair.publicKey,
      isSigner:false,
      isWritable:true
    }
  ],
  programId:pg.PROGRAM_ID
})

const tx = new web3.Transaction()
tx.add(createAccountTxIs,addTxIs);
const hash = await web3.sendAndConfirmTransaction(
  pg.connection,
  tx,
  [pg.wallet.keypair,keypair]
)


const tx1 = new web3.Transaction()
tx1.add({
  keys:[{
    pubkey:keypair.publicKey,
    isSigner:true,
    isWritable:true
  }],
  programId:pg.PROGRAM_ID
})
const hash1 = await web3.sendAndConfirmTransaction(pg.connection,tx1,[pg.wallet.keypair,keypair])

const rawCount = await pg.connection.getAccountInfo(keypair.publicKey)
const count = borsh.deserialize(
  Schema,
  Counter,
  rawCount.data
)



console.log("hash = ",hash1)
console.log(count)
console.log("counter.num = ",count.num)

```


![alt text](image-4.png)

AccountMeta æ¨¡å‹(æ¥æº: solana.com/docs)


#### ä¸€ç¬”äº¤æ˜“ä¸‹çš„å¤šæ¬¡è®¡æ•°
```typescript
class Counter {
  num:number
  constructor(fields:{num:number}|undefined=undefined) {
    if (fields) {
      this.num = fields.num;
    } 
  }
}

const Schema = new Map([
  [Counter,{kind:"struct",fields:[["num","u32"]]}]
])

const space = borsh.serialize(Schema,new Counter()).length
const lamports = await pg.connection.getMinimumBalanceForRentExemption(space)
const keypair = new web3.Keypair()

const tx = new web3.Transaction()

const createAccountTxIs = web3.SystemProgram.createAccount({
  fromPubkey:pg.wallet.publicKey,
  newAccountPubkey:keypair.publicKey,
  space,
  lamports,
  programId:pg.PROGRAM_ID
})

const txIs = new web3.TransactionInstruction({
  keys:[
    {pubkey:keypair.publicKey,isSigner:false,isWritable:false}
  ],
  programId:pg.PROGRAM_ID
})

tx.add(createAccountTxIs,txIs,txIs,txIs)

const txHash = await web3.sendAndConfirmTransaction(pg.connection,tx,[pg.wallet.keypair,keypair])
console.log("txHash = ",txHash)


let account = await pg.connection.getAccountInfo(keypair.publicKey)
const counter = borsh.deserialize(Schema,Counter,account.data);
console.log("counter.num = ",counter.num);

```


#### solana Transaction

![alt text](image-5.png)


transaction ç»“æ„(æ¥æº: solana.com/docs)



![solana Instruction(æ¥æº: solana.com/docs)](image-3.png)

solana Instruction(æ¥æº: solana.com/docs)

```javascript
// web3.sendAndCofrimTransaction
async function sendAndConfirmTransaction(connection, transaction, signers, options) {
  const sendOptions = options && {
    skipPreflight: options.skipPreflight,
    preflightCommitment: options.preflightCommitment || options.commitment,
    maxRetries: options.maxRetries,
    minContextSlot: options.minContextSlot
  };
  const signature = await connection.sendTransaction(transaction, signers, sendOptions);
  let status;
  if (transaction.recentBlockhash != null && transaction.lastValidBlockHeight != null) {
    status = (await connection.confirmTransaction({
      abortSignal: options?.abortSignal,
      signature: signature,
      blockhash: transaction.recentBlockhash,
      lastValidBlockHeight: transaction.lastValidBlockHeight
    }, options && options.commitment)).value;
  } else if (transaction.minNonceContextSlot != null && transaction.nonceInfo != null) {
    const {
      nonceInstruction
    } = transaction.nonceInfo;
    const nonceAccountPubkey = nonceInstruction.keys[0].pubkey;
    status = (await connection.confirmTransaction({
      abortSignal: options?.abortSignal,
      minContextSlot: transaction.minNonceContextSlot,
      nonceAccountPubkey,
      nonceValue: transaction.nonceInfo.nonce,
      signature
    }, options && options.commitment)).value;
  } else {
    if (options?.abortSignal != null) {
      console.warn('sendAndConfirmTransaction(): A transaction with a deprecated confirmation strategy was ' + 'supplied along with an `abortSignal`. Only transactions having `lastValidBlockHeight` ' + 'or a combination of `nonceInfo` and `minNonceContextSlot` are abortable.');
    }
    status = (await connection.confirmTransaction(signature, options && options.commitment)).value;
  }
  if (status.err) {
    if (signature != null) {
      throw new SendTransactionError({
        action: 'send',
        signature: signature,
        transactionMessage: `Status: (${JSON.stringify(status)})`
      });
    }
    throw new Error(`Transaction ${signature} failed (${JSON.stringify(status)})`);
  }
  return signature;
}
```


```javascript
// ç­¾åç®—æ³•
sign(...signers) {
    if (signers.length === 0) {
      throw new Error('No signers');
    }

    // Dedupe signers
    const seen = new Set();
    const uniqueSigners = [];
    for (const signer of signers) {
      const key = signer.publicKey.toString();
      if (seen.has(key)) {
        continue;
      } else {
        seen.add(key);
        uniqueSigners.push(signer);
      }
    }
    this.signatures = uniqueSigners.map(signer => ({
      signature: null,
      publicKey: signer.publicKey
    }));
    const message = this._compile();
    this._partialSign(message, ...uniqueSigners);
  }
```

#### å¤šç¬”äº¤æ˜“ä¸‹çš„å¤šæ¬¡è®¡æ•°
```typescript
class Counter {
  num:number
  constructor(fields:{num:number}|undefined=undefined) {
    if (fields) {
      this.num = fields.num;
    } 
  }
}

const Schema = new Map([
  [Counter,{kind:"struct",fields:[["num","u32"]]}]
])

const space = borsh.serialize(Schema,new Counter()).length
const lamports = await pg.connection.getMinimumBalanceForRentExemption(space);
const keypair = pg.wallet.keypair;


console.log("space = ",space)
console.log("lamports = ",lamports)

const tx = new web3.Transaction()


const createAccountTxIs = web3.SystemProgram.createAccount({
  fromPubkey:pg.wallet.publicKey,
  newAccountPubkey:keypair.publicKey,
  space,
  lamports,
  programId:pg.PROGRAM_ID
})

const txIs = new web3.TransactionInstruction({
  keys:[
    {pubkey:keypair.publicKey,isSigner:false,isWritable:true}
  ],
  programId:pg.PROGRAM_ID
})

tx.add(createAccountTxIs,txIs,txIs,txIs)

const txHash = await web3.sendAndConfirmTransaction(pg.connection,tx,[pg.wallet.keypair,keypair])
console.log("txHash = ",txHash)

const tx1 = new web3.Transaction()
const txIs1 = new web3.TransactionInstruction({
  keys:[
    {pubkey:keypair.publicKey,isSigner:true,isWritable:true}
  ],
  programId:pg.PROGRAM_ID
})
const transferIs = web3.SystemProgram.transfer({
  fromPubkey:pg.wallet.keypair.publicKey,
  toPubkey:keypair.publicKey,
  lamports:web3.LAMPORTS_PER_SOL/2
})

tx1.add(txIs1,transferIs)

const txHash1 = await web3.sendAndConfirmTransaction(pg.connection,tx1,[pg.wallet.keypair,keypair])

console.log("pubkey = ",keypair.publicKey.toString());
console.log("txHash1 = ",txHash1)

const tx2 = new web3.Transaction()
tx2.add(txIs1)
const txHash2 = await web3.sendAndConfirmTransaction(pg.connection,tx2,[keypair])

let account = await pg.connection.getAccountInfo(keypair.publicKey)
const counter = borsh.deserialize(Schema,Counter,account.data);
console.log("counter.num = ",counter.num);



```

#### solana è´¦æˆ·æ‰€æœ‰æƒæ¨¡å‹
solana ä¸­ä»»ä½•è´¦æˆ·éƒ½å½’æŸä¸ªåˆçº¦æ‰€æœ‰ï¼Œè€Œä¸èƒ½ç‹¬ç«‹å­˜åœ¨ã€‚æˆ‘ä»¬å¸¸ç”¨æ¥äº¤æ˜“çš„è´¦æˆ·å½’ SystemProgram æ‰€æœ‰ï¼Œåªæœ‰å®ƒæ‰æ”¯æŒ Solana çš„è½¬è´¦äº¤æ˜“ã€‚å½“æˆ‘ä»¬å’ŒæŸä¸ªåˆçº¦(program)äº¤äº’ä¹‹å‰
å¿…é¡»å…ˆå»ºç«‹ä¸€ä¸ªè¯¥åˆçº¦æ‰€æœ‰çš„å§”æ‰˜è´¦æˆ·ï¼Œé€šè¿‡å§”æ‰˜è´¦æˆ·æ‰å¯ä»¥ä¸è¯¥åˆçº¦äº¤äº’ã€‚

![alt text](image-6.png)  
åŒºå—æµè§ˆå™¨ä¸­è´¦æˆ·æ‰€æœ‰æƒçš„å±•ç¤º



## rust åŸºæœ¬è¯­æ³•
[vs build](https://visualstudio.microsoft.com/zh-hans/downloads/?mode=dark)

[rustup download](https://www.rust-lang.org/zh-CN/tools/install)

### ç±»å‹æ¨æ–­
```rust
let a = 34;
let b:u8 = 12;
let c = "xxxx";
let d = String::from("xxxx");

```

### å¯å˜ä¿®é¥°ç¬¦
```rust
let age = 32;
// age = 23;  æŠ¥é”™
let mut money = 100
let money = 220

```


### å¼•ç”¨
```rust
pub fn main() {
    let mut hobby1 = String::from("football");
    let hobby2 = &mut hobby1;
    // let hobby3 = &hobby1
    println!("hobby1 =  hobby2 = {} hobby3 = ",hobby2);
}
```

### ä½œç”¨åŸŸ
```rust
let animal1 = String::from("car");
{
    let animal2 = &animal1;
}
println!("animal2 = {}",animal);
```

### mod
### åŒæ–‡ä»¶ä¸‹çš„modè°ƒç”¨
```rust
mod sports {
    pub fn do_sports(s:String) {
        println!("I lke {}",s)
    }
}

sports::do_sports(String::from("ping-pong"));
```
### ä¸åŒæ–‡ä»¶ä¸‹çš„modè°ƒç”¨
æ–‡ä»¶ç›®å½•
- src
  - main.rs
  - college
    - mod.rs
    - student.rs


```rust
// mod.rs
pub mod student;
```
```rust
// student.rs
pub struct Student {
    pub name:String,
    pub age:u32
}

impl Student {
    pub fn new(name:String,age:u32) -> Student {
        Student {name:name,age:age}
    }

    pub fn show_msg(&self){
        println!("name {} age {}",self.name,self.age);
    }
}
```
```rust
// main.rs
pub fn main() {
  let s = college::student::Student::new(String::from("å¼ ä¸‰"),17);
  s.show_msg();
}
```

## è®¡æ•°å™¨åˆçº¦ä¸­çš„ rust è¯­æ³•
### ç»“æ„ä½“
rust å¯ä»¥å®šä¹‰å­—æ®µå’Œç»“æ„ä½“æ–¹æ³•ï¼Œå…¶æ˜¯ rust ä¸­é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å®ç°ã€‚
```rust
pub struct Student {
    name:String,
    age:u8,
    score:u32,
    absent_time:u32
}

impl Student{
    fn new(name:String,age:u8,score:u32) -> Self {
        Student{name:name,age:age,score:score, absent_time: 0 }
    }
    fn record(&mut self) {
        self.absent_time+=1
    }
}

pub mod Bank {
    pub struct Account {
        pub id:String,
        pub balance:u32
    }
    impl Account {
        pub fn new(id:String,balance:u32)->Self {
            Account{id:id,balance:balance}
        }
    }
}


fn main() {
    let mut s = Student::new("alice".to_string(), 20, 98);
    println!("name = {} age = {} score = {}",s.name,s.age,s.score);
    println!("absent before access = {}",s.absent_time);
    s.record();
    s.record();


    println!("absent before access = {}",s.absent_time);
    let account = Bank::Account::new("bob".to_string(), 100);
    println!("balance of {} is {}",account.id,account.balance)
}
```



## spl20 ä»£å¸
### åŸç†è®²è§£
![alt text](<mermaid-2025627 224359.png>) 

![alt text](<mermaid-2025627 224635.png>)